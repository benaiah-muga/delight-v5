(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[189],{2833:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/dashboard",function(){return a(1825)}])},1825:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Dashboard}});var i=a(5893),s=a(7294);function Dashboard(){let[e,t]=(0,s.useState)([]),[a,l]=(0,s.useState)(!0),[n,r]=(0,s.useState)(!1),[c,d]=(0,s.useState)({id:null,title:"",description:"",price:"",imageUrl:"",imageFile:null}),[o,m]=(0,s.useState)(null);async function fetchData(){let e=await fetch("/api/properties");if(401===e.status){window.location.href="/admin/login";return}let a=await e.json();t(a),l(!1);let i=await fetch("/api/session");if(i.ok){let e=await i.json();m(e.role)}}async function submitForm(e){e.preventDefault();let t=new FormData;t.append("title",c.title),t.append("description",c.description),t.append("price",c.price),c.imageFile&&t.append("image",c.imageFile),c.imageUrl&&t.append("imageUrl",c.imageUrl);let a="/api/properties",i="POST";c.id&&(a="/api/properties/".concat(c.id),i="PUT");let s=await fetch(a,{method:i,body:t});if(s.ok)r(!1),fetchData();else{let e=await s.text();alert(e)}}async function remove(e){if(!confirm("Delete listing?"))return;let t=await fetch("/api/properties/"+e,{method:"DELETE"});t.ok?fetchData():alert("Failed to delete")}async function logout(){await fetch("/api/logout",{method:"POST"}),window.location.href="/admin/login"}return(0,s.useEffect)(()=>{fetchData()},[]),(0,i.jsxs)("div",{className:"max-w-6xl mx-auto px-6 py-8",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,i.jsx)("h1",{className:"text-2xl font-semibold",children:"Admin Dashboard"}),(0,i.jsxs)("div",{className:"space-x-2",children:[(0,i.jsx)("button",{onClick:function(){d({id:null,title:"",description:"",price:"",imageUrl:""}),r(!0)},className:"bg-green-600 text-white px-3 py-2 rounded",children:"Add Listing"}),(0,i.jsx)("button",{onClick:logout,className:"bg-gray-200 px-3 py-2 rounded",children:"Logout"})]})]}),(0,i.jsx)("div",{className:"bg-white p-4 rounded card-shadow",children:a?(0,i.jsx)("p",{children:"Loading..."}):(0,i.jsxs)("table",{className:"w-full table-auto",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"text-left text-sm text-gray-500",children:[(0,i.jsx)("th",{className:"p-2",children:"Image"}),(0,i.jsx)("th",{className:"p-2",children:"Title"}),(0,i.jsx)("th",{className:"p-2",children:"Price"}),(0,i.jsx)("th",{className:"p-2",children:"Actions"})]})}),(0,i.jsx)("tbody",{children:e.map(e=>(0,i.jsxs)("tr",{className:"border-t",children:[(0,i.jsx)("td",{className:"p-2 w-24",children:e.image?(0,i.jsx)("img",{src:e.image,alt:"",className:"h-16 w-24 object-cover rounded"}):(0,i.jsx)("div",{className:"h-16 w-24 bg-gray-100 rounded"})}),(0,i.jsx)("td",{className:"p-2",children:e.title}),(0,i.jsx)("td",{className:"p-2",children:e.price}),(0,i.jsxs)("td",{className:"p-2",children:[(0,i.jsx)("button",{onClick:()=>{d({...e,imageUrl:e.image||""}),r(!0)},className:"mr-2 bg-blue-600 text-white px-3 py-1 rounded",children:"Edit"}),"admin"===o&&(0,i.jsx)("button",{onClick:()=>remove(e.id),className:"bg-red-600 text-white px-3 py-1 rounded",children:"Delete"})]})]},e.id))})]})}),n&&(0,i.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"bg-white w-full max-w-2xl p-6 rounded",children:[(0,i.jsx)("h3",{className:"text-xl font-semibold mb-4",children:c.id?"Edit Listing":"Create Listing"}),(0,i.jsxs)("form",{onSubmit:submitForm,className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"text-sm",children:"Title"}),(0,i.jsx)("input",{className:"mt-1 block w-full border rounded p-2",value:c.title,onChange:e=>d({...c,title:e.target.value}),required:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"text-sm",children:"Description"}),(0,i.jsx)("textarea",{className:"mt-1 block w-full border rounded p-2",rows:"4",value:c.description,onChange:e=>d({...c,description:e.target.value}),required:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"text-sm",children:"Price"}),(0,i.jsx)("input",{className:"mt-1 block w-full border rounded p-2",value:c.price,onChange:e=>d({...c,price:e.target.value}),required:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"text-sm",children:"Image URL (optional)"}),(0,i.jsx)("input",{className:"mt-1 block w-full border rounded p-2",value:c.imageUrl,onChange:e=>d({...c,imageUrl:e.target.value})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"text-sm",children:"Or upload image (optional)"}),(0,i.jsx)("input",{type:"file",className:"mt-1 block",onChange:e=>d({...c,imageFile:e.target.files[0]})})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded",type:"submit",children:"Save"}),(0,i.jsx)("button",{type:"button",onClick:()=>r(!1),className:"px-4 py-2 rounded border",children:"Cancel"})]})]})]})})]})}a(1664)}},function(e){e.O(0,[774,888,179],function(){return e(e.s=2833)}),_N_E=e.O()}]);